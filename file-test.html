<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmpTier — Test SMP</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<header class="header container">
  <img src="assets/logo.png" alt="logo" class="logo">
  <div class="brand-section">
    <div class="brand">SmpTier</div>
    <div class="lead">Soumettre votre SMP</div>
  </div>
  <nav>
    <a href="index.html">Accueil</a>
    <a href="criteres.html">Critères</a>
    <a href="classement.html">Classement</a>
    <a href="file-test.html">Tester mon SMP</a>
    <a href="admin.html">Admin</a>
  </nav>
</header>

<main>
  <section class="section card">
    <h2>Formulaire de test SMP</h2>
    <form id="smpForm">
      <input type="text" placeholder="Nom du SMP" required>
      <input type="text" placeholder="IP / Adresse du serveur" required>
      <input type="text" placeholder="Votre Discord" required>
      <button type="submit" class="btn btn-primary">Envoyer</button>
    </form>
    <p class="lead" id="confirmation"></p>
  </section>
</main>

<script type="module">
import { db } from './firebase-init.js';
import { collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const form = document.getElementById('smpForm');
const confirmation = document.getElementById('confirmation');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const inputs = form.querySelectorAll('input');
  try {
    const docRef = await addDoc(collection(db,'smp_queue'),{
      name: inputs[0].value,
      ip: inputs[1].value,
      discord: inputs[2].value,
      timestamp: serverTimestamp()
    });
    confirmation.innerHTML = `Inscription réussie ! Suivez votre SMP avec ce lien unique : 
      <a href="track.html?id=${docRef.id}" target="_blank">Voir mon SMP</a>`;
    form.reset();
  } catch(err){
    console.error(err);
    confirmation.textContent = 'Erreur lors de l\'inscription.';
  }
});
</script>

<footer class="footer">
  © 2025 SmpTier
</footer>
</body>
</html>

